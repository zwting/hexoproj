---
title: Mathematics.for.3D.Game.Programming.and.Computer.Graphicsé˜…è¯»ç¬”è®°
date: 2017-08-24 14:08:28
tags: OpenGL, å›¾å½¢å­¦
---

### å†™åœ¨å‰é¢çš„è¯: 
> æœ¬æ–‡åŸºæœ¬ç­‰åŒä¸ç¿»è¯‘(åŠ ä¸Šè‡ªå·±çš„ç†è§£), ç¬”è€…è‹±è¯­æ°´å¹³æœ‰é™, éš¾å…ä¼šå‡ºç°é”™è¯¯, æœ›é«˜æ‰‹åœ¨è¯„è®ºä¸­æŒ‡å‡º, è°¢è°¢!
> åŸä¹¦: [Mathematics for 3D Game Programming and Computer Graphics, Third Edition][1_booksite] 

### ä¸€. æ¸²æŸ“ç®¡çº¿
#### 1.1 å›¾å½¢å¤„ç†å™¨
é€šå¸¸ä¸€ä¸ªè¢«3Då›¾å½¢æ¸²æŸ“çš„åœºæ™¯æœ‰å¾ˆå¤šç‹¬ç«‹çš„å¯¹è±¡ç»„æˆ. è¿™äº›å¯¹è±¡çš„å‡ ä½•è¡¨ç°å°±æ˜¯æ¯ä¸€ä¸ªè¢«è¡¨ç°ä¸ºä¸€äº›é¡¶ç‚¹çš„å’Œä¸€ä¸ªç‰¹å®šç±»å‹çš„å›¾å…ƒ(è¡¨æ˜äº†é¡¶ç‚¹æ˜¯æ€ä¹ˆçš„å½¢å¼ç»„æˆä¸€ä¸ªå½¢çŠ¶). å›¾1.1åˆ—å‡ºäº† OpenGLå›¾å½¢åº“å®šä¹‰äº†10ç§å›¾å…ƒ. å›¾å½¢ç¡¬ä»¶å¯ä»¥æ¸²æŸ“ä¸€ç³»åˆ—ç‹¬ç«‹çš„ç‚¹, ä¸€äº›çº¿æ®µ, æˆ–è€…ä¸€ç»„è¢«å¡«å……çš„å¤šè¾¹å½¢. å¤§å¤šæ•°æ—¶é—´, 3Dæ¨¡å‹çš„è¡¨é¢æ˜¯ç”±ä¸€äº›ä¸‰è§’å½¢æ„æˆçš„, æ¯ä¸€ä¸ªä¸‰è§’å½¢å¼•ç”¨äº†å®šç‚¹åˆ—è¡¨ä¸­çš„ä¸‰ä¸ªç‚¹.
> ![å›¾1.1, æ¥è‡ªåŸä¹¦æˆªå›¾](/img/201708/2017-08-24 .png)

ç°ä»£çš„3Då›¾å½¢å¡é€šå¸¸ä¼šæ‰§è¡Œä»CPUå‘å‡ºçš„ä¸€äº›æŒ‡ä»¤, CPUæƒ³GPUå‘å‡ºæ¸²æŸ“å‘½ä»¤, ç„¶åCPUä¼šæ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡, è€ŒGPUä¼šæ‰§è¡Œè¿™äº›æ¸²æŸ“æ“ä½œ. è¿™é€šå¸¸è¢«ç§°ä¸º***å¼‚æ­¥æ“ä½œ***. å½“éœ€è¦è¢«æ¸²æŸ“çš„å›¾å½¢ä¿¡æ¯è¢«æäº¤åˆ°æ¸²æŸ“åº“(OpenGLç­‰)çš„æ—¶å€™, è¯·æ±‚æ¸²æŸ“æ“ä½œçš„å‡½æ•°å°†ä¼šåœ¨æ¸²æŸ“æ“ä½œè¿˜æœªå®Œæˆå‰å¾ˆæ—©å°±è¿”å›. è¿™äº›åœ¨ä¸€ä¸ªæ¸²æŸ“å‘½ä»¤çš„å­æ“ä½œå’Œæ¸²æŸ“å®Œæˆä¹‹é—´çš„æ»åæ—¶é—´å°†ä¸ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜, ä½†æ˜¯åœ¨æ¸²æŸ“å®Œæˆçš„æ—¶åˆ»æ˜¯éœ€è¦çŸ¥é“çš„. å¹¸è¿çš„æ˜¯, ç›®å‰OpenGLçš„ä¸€äº›æ‰©å±•å¯ç¨‹åºä»¥åœ¨CPUä¸­è¿è¡Œ, è¿™äº›ç¨‹åºèƒ½å¤Ÿåœ¨GPUå®Œæˆæ¸²æŸ“çš„æ—¶å€™å‘å‡ºé€šçŸ¥.ä½†åŒæ—¶ä¼šå¸¦æ¥æ€§èƒ½æŸè€—, è¿™ç§å¼‚æ­¥æ“ä½œä¼šæ‹–æ…¢3Då›¾å½¢ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦, å› æ­¤, å¦‚æœæƒ³è¦æ€§èƒ½ä¼˜å…ˆ, é‚£ä¹ˆåº”è¯¥é¿å…è¿™äº›æ“ä½œ.

é‚£ä¹ˆåº”ç”¨ç¨‹åºå’ŒGPUçš„é€šä¿¡æ˜¯æ€ä¹ˆæ¥è¿›è¡Œå‘¢? é€šå¸¸æ˜¯é€šè¿‡ä¸€äº›ç¬¬ä¸‰æ–¹çš„å›¾å½¢åº“æ¥å®ç°çš„, æ¯”å¦‚OpenGL. è¿™äº›åº”ç”¨å°†ä¼šé€šè¿‡è°ƒç”¨OpenGL APIæ–¹å¼æ¥å‘å…¶å‘å‡ºæ¸²æŸ“å‘½ä»¤. è€ŒOpenGLç­‰å›¾å½¢åº“åˆå‘GPUé©±åŠ¨ç¨‹åºå‘é€æ¸²æŸ“å‘½ä»¤, è¿™äº›é©±åŠ¨ç¨‹åºæ‰çŸ¥é“æ€æ ·å’ŒGPUäº¤æµ. OpenGLçš„è¿™äº›æ¥å£æˆ‘ä»¬ç§°ä¹‹ä¸º***Hardware Abstraction Layer(HAL) ç¡¬ä»¶æŠ½è±¡å±‚***, å› ä¸ºå®ƒæä¾›äº†ä¸€äº›é€šç”¨çš„å‡½æ•°å¯ä»¥ç”¨æ¥æ¸²æŸ“åœºæ™¯, è¿™äº›å‡½æ•°å¯ä»¥åœ¨ä»»ä½•æ”¯æŒOpenGLæ¶æ„çš„å›¾å½¢ç¡¬ä»¶ä¸Šè¿è¡Œ. é©±åŠ¨ç¨‹åºå°†ä¼šæŠŠè¿™äº›OpenGLçš„APIè½¬æ¢æˆGPUå¯ä»¥æ‰§è¡Œçš„å‘½ä»¤. 3Då›¾å½¢é©±åŠ¨ç¨‹åºé€šå¸¸ä¼šç›´æ¥å®ç°OpenGLå‡½æ•°ä»¥æœ€å°åŒ–æ¸²æŸ“å‘½ä»¤çš„å¼€é”€. ***å›¾1.2*** å±•ç¤ºäº†CPUå’ŒGPUä¹‹é—´çš„é€šä¿¡è¿‡ç¨‹:
>![å›¾1.2 CPUå’ŒGPUä¹‹é—´çš„é€šä¿¡(æ¥è‡ªåŸä¹¦æˆªå›¾)](/img/201708/2017-08-24 3.48.18.png)

ä¸€ä¸ª3Då›¾å½¢å¡æœ‰è‡ªå·±çš„å­˜å‚¨ç©ºé—´(æ˜¾å­˜), é€šå¸¸è¢«ç§°ä¸º***VRAM (Video Random Access Memory)***. GPUå¯ä»¥åœ¨VRAMä¸­å­˜å‚¨ä»»ä½•ä¸œè¥¿, å½“æ—¶åœ¨3Dåº”ç”¨ç¨‹åºè¿è¡Œçš„æ—¶å€™, æœ‰è¿™ä¹ˆå‡ ç±»æ•°æ®å¤§å¤šæ•°æ€»å¯ä»¥åœ¨æ˜¾å­˜ä¸­æ‰¾åˆ°. VRAMä¸­æœ‰ä¸¤ä¸ªå›¾åƒç¼“å†²åŒº, è¢«ç§°ä¸ºå‰ç¼“å†²å’Œåç¼“å†² (ä¼ è¯´ä¸­çš„[***åŒç¼“å†²***][2_double_swap]). å…¶ä¸­, `front image buffers` åŒ…å«äº†å½“å‰åœ¨å¯è§†åŒºåŸŸå†…çœ‹åˆ°çš„æ¯ä¸€ä¸ªåƒç´ çš„æ•°æ®. *å¯è§†åŒºåŸŸ* æŒ‡çš„å°±æ˜¯åŒ…å«äº†å·²ç»è¢«æ¸²æŸ“çš„å›¾è±¡æ•°æ®çš„ä¸€ä¸ªåŒºåŸŸ, ä»–å¯èƒ½æ˜¯ä¸€ä¸ªçª—å£, ä¹Ÿå¯èƒ½æ˜¯æ•´ä¸ªå±å¹•; `back image buffer`æ˜¯GPUçœŸæ­£æ¸²æŸ“çš„åœºæ™¯çš„ä½ç½®. `back buffer` åœ¨æ¸²æŸ“å®Œæˆå‘ˆç°ç»™ç”¨æˆ·ä¹‹å‰æ˜¯ä¸å¯è§çš„. ä¸€æ—¦ä¸€ä¸ªå›¾åƒå®Œæˆäº†æ¸²æŸ“, `back buffer` å’Œ `front buffer` å°†ä¼šäº¤æ¢æ•°æ®. è¿™ä¸ªæ“ä½œè¢«ç§°ä¸º`ç¼“å†²äº¤æ¢`. ä»–å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°:
> 1. ç›´æ¥äº¤æ¢ä¸¤ä¸ªç¼“å†²åŒºçš„å†…å­˜åœ°å€
> 2. å°†`back buffer`ä¸­çš„æ•°æ®æ‹·è´åˆ°`fornt buffer`ä¸­

ç¼“å†²åŒºäº¤æ¢é€šå¸¸å’Œå›¾åƒæ˜¾ç¤ºåˆ·æ–°ç‡ä¿æŒåŒæ­¥, è¿™æ˜¯ä¸ºäº†é¿å…å‘ç”Ÿ`ç”»é¢æ’•è£‚ç°è±¡`. `ç”»é¢æ’•è£‚`é€šå¸¸ç”±äºåœ¨åˆ·æ–°æœŸé—´å‘ç”Ÿäº†ç¼“å†²åŒºäº¤æ¢, è¿™å°†ä¼šå¯¼è‡´ä¸€å‰¯å›¾åƒçš„ä¸ŠåŠéƒ¨åˆ†å’Œä¸‹åŠéƒ¨åˆ†ä¸åŒ, å› ä¸ºä»–ä»¬çš„æ•°æ®åˆ†åˆ«æ¥è‡ª`front buffer`å’Œ`back buffer`.

è¿˜æœ‰ä¸€å—å­˜å‚¨åœ¨VRAMä¸­çš„æ•°æ®å—è¢«ç§°ä¸º`Depth-buffer`æˆ–è€…`z-buffer`. `æ·±åº¦ç¼“å†²`å­˜å‚¨çš„æ•°æ®æ˜¯å›¾åƒç¼“å†²ä¸­çš„æ¯ä¸€ä¸ªåƒç´ æ•°æ®çš„`depth`,`depth`è¡¨æ˜è¿™ä¸ªåƒç´ è·ç¦»å±å¹•æœ‰å¤šè¿œæˆ–è€…è¿™ä¸ªåƒç´ ä½äºå›¾åƒä¸­çš„å“ªä¸ªæ·±åº¦. `æ·±åº¦ç¼“å†²`é€šå¸¸ç”¨æ¥éšè—æˆ–è¡¨é¢æ¶ˆé™¤çš„åŠŸèƒ½, å®ƒåªç»˜åˆ¶æ·±åº¦å°äºå›¾åƒç¼“å†²å»æ·±åº¦çš„åƒç´ . `Depth`åŒæ—¶ä¹Ÿè¡¨æ˜äº†ä»è¢«ç»˜åˆ¶çš„åœºæ™¯åˆ°è™šæ‹Ÿç›¸æœº(å……å½“äººçœ¼çš„é‚£ä¸ªä½ç½®)çš„è·ç¦». è€Œ`z-buffer`è¿™ä¸ªåå­—æ¥è‡ªäºç›¸æœºçš„Zè½´, å®ƒæ˜¯ä»ç›¸æœºçš„åæ ‡ç©ºé—´å°„å‘å±å¹•çš„æ–¹å‘.
éšç€`image buffer`å’Œ`depth buffer`çš„åˆ›å»º, åº”ç”¨ç¨‹åºå¯èƒ½ä¼šè¯·æ±‚`stencil buffer(æ¨¡æ¿ç¼“å†²åŒº)`. `stencil buffer`åŒ…å«äº†ä¸€ä¸ªæ•´å‹çš„é®ç½©, è¿™å’Œ`image buffer`ä¸­çš„æ¯ä¸€ä¸ªåƒç´ éƒ½æ˜¯ä¸€ä¸€å¯¹åº”çš„, ä»–å¯ä»¥ç”¨æ¥æ§åˆ¶ç‰¹å®šçš„åƒç´ æ˜¯å¦è¢«ç»˜åˆ¶. æ›´é«˜çº§çš„`stencil buffer`å¯ä»¥ç”¨æ¥äº§ç”Ÿå®æ—¶é˜´å½±.
å¤§å¤šæ•°3Dæ¸²æŸ“åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨VRAMä¸»è¦é€šè¿‡`Texture maps(çº¹ç†è´´å›¾)`, `texture maps`é€šå¸¸è¢«ç”¨æ¥é™„ç€åˆ°ç‰©ä½“çš„è¡¨é¢ä»¥è¾¾åˆ°æ›´å¥½çš„è§†è§‰ç»†èŠ‚. åœ¨é«˜çº§æ¸²æŸ“ç¨‹åºä¸­, `texture maps`é€šå¸¸åŒ…å«äº†æ¯”ç®€å•åƒç´ å›¾åƒæ›´å¤šçš„ä¿¡æ¯. ä¾‹å¦‚: ä¸€ä¸ª[`bump map(å‡¹å‡¸è´´å›¾)`][3_bumpmap]åŒ…å«çš„ä¿¡æ¯æ˜¯ä¸€ä¸ªä¸ªçš„å‘é‡, è¿™äº›å‘é‡è¡¨æ˜äº†ç‰©ä½“è¡¨é¢å¯¹åº”ä½ç½®çš„å€¾æ–œç¨‹åº¦. 

#### 1.2 å‘é‡å˜æ¢

å‡ ä½•æ•°æ®ä»¥3ç»´ç©ºé—´çš„å½¢å¼ä¼ ç»™äº†å›¾å½¢ç¡¬ä»¶. æ¥ä¸‹æ¥å›¾å½¢ç¡¬ä»¶éœ€è¦åšçš„å°±æ˜¯å°±æ˜¯å°†è¿™äº›æ•°æ®è½¬æ¢åˆ°2ç»´ç©ºé—´çš„è§†å£å†…. åœ¨`rendering pipeline(æ¸²æŸ“ç®¡çº¿)` è¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šä¸ä¹‹ç›¸å…³è”çš„åæ ‡ç³»ç»Ÿ, ä»–ä»¬ä¹‹é—´çš„è½¬æ¢è¿‡ç¨‹å¦‚`å›¾1.3`. ä¸€ä¸ª3D æ¨¡å‹çš„é¡¶ç‚¹é€šå¸¸å­˜å‚¨åœ¨å¯¹è±¡çš„`object space(æ¨¡å‹åæ ‡ç©ºé—´)`å†…, è¿™ä¸ªåæ ‡ç³»ç»Ÿå–å†³äºç‰¹å®šçš„æ¨¡å‹.æ¯ä¸€ä¸ªæ¨¡å‹çš„ä½ç½®é€šå¸¸è¢«å­˜å‚¨åœ¨`word space(ä¸–ç•Œåæ ‡ç©ºé—´)`ä¸­, è¿™ä¸ªåæ ‡ç©ºé—´å°†æ‰€æœ‰çš„å¯¹è±¡è¿æ¥åˆ°ä¸€ä¸ªå…¨å±€çš„åæ ‡ç©ºé—´ä¸­. åœ¨æ¯ä¸€ä¸ªå¯¹è±¡è¢«æ¸²æŸ“ä¹‹å‰, å®ƒçš„é¡¶ç‚¹å¿…é¡»è¢«è½¬æ¢åˆ°`camera space(ç›¸æœºç©ºé—´)`ä¸­, è¿™ä¸ªåæ ‡ç©ºé—´çš„xå’Œyè½´é€‚åˆæ˜¾ç¤ºåŒºåŸŸçš„xå’Œyå¹³è¡Œçš„. æ¨¡å‹çš„é¡¶ç‚¹æ˜¯å¯ä»¥ç›´æ¥ä»`æ¨¡å‹ç©ºé—´`è½¬æ¢åˆ°`ç›¸æœºç©ºé—´`çš„,å…·ä½“åšæ³•å°±æ˜¯é€šè¿‡çŸ©é˜µä¹˜æ³•å°† `æ¨¡å‹åæ ‡`->`ä¸–ç•Œåæ ‡`çš„å˜æ¢çŸ©é˜µM<sub>obj-word</sub> å’Œ `ä¸–ç•Œåæ ‡`->`ç›¸æœºåæ ‡`çš„å˜æ¢çŸ©é˜µM<sub>word-camera</sub> è¿æ¥èµ·æ¥,å¾—åˆ°M<sub>obj-camera</sub>ç§°ä¹‹ä¸º `model-view`å˜æ¢.
ä¸€æ—¦æ¨¡å‹çš„é¡¶ç‚¹è¢«è½¬æ¢åˆ°äº†`ç›¸æœºç©ºé—´`,ä»–ä»¬ä¼šç»å†ä¸€ä¸ªæŠ•å½±å˜æ¢, è¿™ä¸ªå˜æ¢å°†ä¼šè¾¾åˆ°äººçœ¼è§†è§‰ç³»ç»Ÿè¿‘å¤§è¿œå°çš„è§†è§‰æ•ˆæœ. è¿™ä¸ªæŠ•å½±æ˜¯é€šè¿‡å››ç»´ç©ºé—´å…¶æ¬¡åæ ‡æ¥å®Œæˆçš„, åœ¨è¿™äº›é¡¶ç‚¹å®ŒæˆæŠ•å½±åçš„åæ ‡ç©ºé—´è¢«ç§°ä¸º`homogeneous clip space(é½æ¬¡è£å‰ªç©ºé—´)`, ä¹‹æ‰€ä»¥è¿™ä¹ˆå«å®ƒ, æ˜¯å› ä¸ºåœ¨è¿™ä¸ªåæ ‡ç©ºé—´,å›¾å…ƒä¼šè¢«è£å‰ªåœ¨å¯è§†åŒºåŸŸå†…,ç¡®ä¿è½åœ¨å¯è§†åŒºåŸŸå¤–é¢çš„å›¾å…ƒä¸ä¼šè¢«æ¸²æŸ“.
> ![å›¾1.3(æ¥è‡ªåŸä¹¦æˆªå›¾)](/img/201708/2017-08-24 5.29.50.png)

åœ¨é½æ¬¡åæ ‡ç©ºé—´ä¸­, 








[1_booksite]: http://www.mathfor3dgameprogramming.com/
[2_double_swap]: https://baike.baidu.com/item/%E5%8F%8C%E7%BC%93%E5%86%B2/10953356?fr=aladdin
[3_bumpmap]: https://en.wikipedia.org/wiki/Bump_mapping